---
layout: post

title: 支持向量机的应用：兵王问题

categories: 机器学习 Matlab

---

## 问题场景

8X8的国际象棋棋盘中，兵和王的规则如下：

1. 兵黑白各一个，第一次向前可以走一格或两格，以后每次只能向前走一格，不能后退。吃子时只能吃斜前方的子，并且落在此处。
2. 王黑白各一个，王被将死则告负。王每次横走、直走或斜走一格，吃子与走法相同。
3. 兵的升变：当兵走到对方的底线，可以升变为除王以外的任意棋子。比如王后，如果升变为王后和王配合，一定可以杀死对方的王。
4. 逼和：如果一方的王未被将军，但移动到任意的地方都会被对方将死，则此时是和棋。

兵王问题如下：

国际象棋中的残局，黑方只剩下一个王，白方剩下一个兵和一个王，判断局面的最终结果。

局面有两种可能（由三个棋子在棋盘上的位置决定）

1. 白方将死黑方，白方获胜
2. 和棋

## 基本思路

在不输入计算机规则的前提下，利用SVM让计算机判断兵王问题的结果。

## 工具准备

### 数据集

来自UCI中标注好的训练数据krkopt.data。数据的具体含义如下：

每一行都是一个训练样本。

如第一行：

a1：黑王的位置

b3：白王的位置

c2：白兵的位置

draw：标签，表示和棋。

six：白方最多用六步就能将死黑方

![IMG_CD5B3D248CF1-1](/images/posts/IMG_CD5B3D248CF1-1.jpeg)

兵王问题是二分类问题。将和棋看作 $y_i=+1$，其他情况看作 $y_i=-1$。

提供的总样本数有28056个

正样本数2796个

负样本数25260个

### LIBSVM

采用LIBSVM工具包使用支持向量机程序进行训练。工具包来源：[http://www.csie.ntu.edu.tw/~cjlin/libsvm/](http://www.csie.ntu.edu.tw/~cjlin/libsvm/)。

采用LIBSVM工具包的matlab封装。

### Matlab

因为此前我从未接触过Matlab。

## 处理步骤

### 对数据扩增

在机器学习编写算法的过程中，常常产生训练样本过少，导致学习效果不明显的情况，所以我们会使用Data Augmentation对训练样本进行扩增。

按照国际象棋的规则：

黑方想要防止自己被将死必须防止白方的兵走到自己的底线，从而升变成王后这样的棋子，王后可以横、竖、斜走若干步，一定可以将死对方的王。

利用这个规则给数据扩增，可以制造所有白兵位置在a8,b8......h8时，$y_i=-1$。

扩展生成数据集的代码如下：

```python

```

进行扩展后得到的数据集有：

总样本数：

正样本数：

负样本数：

### 对数据预处理

随机选取5000个样本训练，其余样本用作测试。

### 对训练样本归一化(Normalization of training data)

对训练样本归一化可以将输入特征的每个维度限定在固定的范围内，从而减少不同维度由于动态范围不同导致的训练误差。

在训练样本上，求出每个维度的均值和方差，在训练和测试样本上同时归一化。							
$$
newX=\frac{x-mean(x)}{std(x)}​
$$
代码如下：

```python

```

### 设置支持向量机的各种参数

1. -s

   -s表示svm type，选择0代表目标函数为 $\frac{1}{2}||w||^2+C\displaystyle\sum_{i=1}^{N}\delta_i$

2. -t

   -t表示kernel type，选择2表示选择Rbf（高斯径向基函数核）。

3. -c

   -c表示C的值，默认为1。

4. -g

   表示gemma value，与核函数相对应。例如当t取2时，-g对应的含义为 $\displaystyle\frac{1}{\sigma^2}$

5. -v

   表示交叉验证，选择5表示进行5折交叉验证。

具体在matlab的操作如下：

### 搜索C和gemma

在LIBSVM网站上有说明，根据人工的经验，C的取值范围为 $2^{-5}-2^{15}$，gemma的取值范围为 $2^{-15}-2^{3}$。

遍历上述C和gemma的取值范围，选择最适合的C和gemma值。为了达到这个目的，我们要使用5折交叉验证(5-fold cross validation)的方法，将5000个训练样本等分为5份A、B、C、D、E。接下来循环操作：

- 第一步：用ABCD训练，用E测试，获得识别率。
- 第二步：用ABCE训练，用D测试，获得识别率。
- 第三步：用ABDE训练，用C测试，获得识别率。
- 第四步：用ACDE训练，用B测试，获得识别率。
- 第五步：用BCDE训练，用A测试，获得识别率。

再将5个识别率进行平均得到总的识别率。

### 计算ROC和EER

### 存在可改进的地方

1. 训练样本中正样本数与负样本数相比少了很多，因此产生了类别不平衡的问题，如果更熟悉国际象棋的规则，可以扩增正样本。

## 参考资料

[1] 机器学习，mooc上胡浩基课程